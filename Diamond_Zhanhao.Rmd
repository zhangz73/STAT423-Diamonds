---
title: "Diamond"
author: "Zhanhao Zhang"
date: "2/17/2020"
output: pdf_document
---

Required Packages:
```{r}
library(corrplot)
library(tidyverse)
library(data.table)
```

Load Data:
```{r}
diamond <- read.csv("diamonds.csv")
summary(diamond)
hist(diamond$carat, probability = T, main = "Histogram of Weight",
     xlab = "carat", breaks = 10)
```
Histograms:
```{r}
plot_histograms <- function(var = "all", num_plot_row = 2){
  plot_single_histogram <- function(single_var){
    if(is.numeric(diamond[[single_var]])){
      hist(diamond[[single_var]], 
                main = paste("Histogram of", single_var), xlab = single_var)
    } else{
      plot(diamond[[single_var]], xlab = single_var,
                main = paste("Histogram of", single_var))
    }
  }
  
  plot_multiple_histograms <- function(multiple_var){
    len <- length(multiple_var)
    if(ceiling(len / num_plot_row) > 3){
      par(mfrow = c(3, num_plot_row))
      for(i in 1:(3 * num_plot_row)){
        plot_single_histogram(multiple_var[i])
      }
      par(mfrow = c(1, 1))
      plot_multiple_histograms(multiple_var[(3 * num_plot_row + 1) : len])
    } else{
      n.rows <- ceiling(length(var) / num_plot_row)
      par(mfrow = c(n.rows, num_plot_row))
      for(i in 1:len){
        plot_single_histogram(multiple_var[i])
      }
      par(mfrow = c(1, 1))
    }
  }
  
  if(length(var) > 1){
    plot_multiple_histograms(var)
  } else if(var == "all"){
    plot_multiple_histograms(colnames(diamond)[2:ncol(diamond)])
  } else{
    plot_single_histogram(var)
  }
}

plot_histograms()
plot_histograms("carat")
plot_histograms(c("carat", "x", "y", "z"))
```

Correlation Matrices and Plots:
```{r}
plot_correlations <- function(var = "all"){
  if(length(var) > 1){
    df <- c()
    for(v in var){
      df <- cbind(df, as.numeric(diamond[[v]]))
    }
    colnames(df) <- var
    cor(df)
    corrplot(cor(df), method = "circle")
  } else if(var == "all"){
    plot_correlations(colnames(diamond)[2:ncol(diamond)])
  } else{
    stop("You should give at least 2 predictors!")
  }
}

plot_correlations()
```

Compress Data Frame:
```{r}
get_compressed_df <- function(dataframe, predictor_to_compress, 
                              compressed_vector, bin.width){
  df_new <- c()
  for(v in compressed_vector){
    tmp <- dataframe[dataframe[[predictor_to_compress]] <= v + bin.width & 
                       dataframe[[predictor_to_compress]] >= v - bin.width,]
    tmp[[predictor_to_compress]] <- v
    df_new <- rbind(data.frame(df_new), data.frame(tmp))
  }
  return(df_new)
}

compressed_df <- get_compressed_df(diamond, "carat", c(0.3, 0.5, 0.8, 1, 1.5), 0.03)
summary(compressed_df)
head(compressed_df)
```

Model Evaluation -- Assumptions on Residual:
```{r}
plot_residual_assumptions <- function(lm){
  par(mfrow = c(2, 2))
  plot(lm, which = 1)
  qqnorm(lm$residuals)
  plot(lm, which = 4)
  plot(lm, which = 5)
  par(mfrow = c(1, 1))
}
plot_residual_assumptions(lm(price ~ . - X, data = diamond))
```
